<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Reservas de Estacionamiento</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Sistema de Reservas de Estacionamiento</h1>
        <div class="header-controls">
            <button id="theme-toggle" class="theme-toggle-btn">Modo oscuro</button>
            <button id="logoutButton" style="display: none;">Cerrar Sesión</button>
        </div>
    </header>

    <main role="main">
        <section id="authSection" aria-labelledby="auth-heading">
            <!-- Login View -->
            <div id="loginView">
                <h2 id="auth-heading">Iniciar Sesión</h2>
                <form id="loginForm" role="form" aria-label="Formulario de inicio de sesión">
                    <div class="form-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" required aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Contraseña:</label>
                        <input type="password" id="loginPassword" required aria-required="true">
                    </div>
                    <button type="submit">Iniciar Sesión</button>
                    <p class="forgot-password-link"><a href="#" id="forgotPasswordLink">¿Olvidaste tu contraseña?</a></p>
                    <p class="toggle-auth-view">¿No tienes una cuenta? <a href="#" id="showRegisterLink">Regístrate</a></p>
                </form>
            </div>

            <!-- Register View -->
            <div id="registerView" style="display: none;">
                <h2>Registrarse</h2>
                <form id="registerForm" role="form" aria-label="Formulario de registro">
                    <!-- Campo Nombre -->
                    <div class="form-group">
                        <label for="registerName">Nombre Completo</label>
                        <input type="text" id="registerName" name="name" required autocomplete="name">
                    </div>
            
                    <!-- Campo Email -->
                    <div class="form-group">
                        <label for="registerEmail">Correo Electrónico</label>
                        <input type="email" id="registerEmail" name="email" required autocomplete="email">
                    </div>
            
                    <!-- Campo RUT -->
                    <div class="form-group">
                        <label for="register-rut">RUT</label>
                        <input type="text" id="register-rut" name="rut" placeholder="12.345.678-9" autocomplete="off">
                    </div>
            
                    <!-- Campo Teléfono -->
                    <div class="form-group">
                        <label for="register-phone">Teléfono</label>
                        <div class="phone-input-group">
                            <span>+56</span>
                            <input type="tel" id="register-phone" name="phone_number" placeholder="9 1234 5678" autocomplete="tel-national">
                        </div>
                    </div>
            
                    <!-- Campo Patente -->
                    <div class="form-group">
                        <label for="register-plate">Patente Vehicular</label>
                        <input type="text" id="register-plate" name="license_plate" placeholder="ABCD-12" autocomplete="off" style="text-transform: uppercase;">
                    </div>
            
                    <!-- Campo Contraseña -->
                    <div class="form-group">
                        <label for="registerPassword">Contraseña:</label>
                        <input type="password" id="registerPassword" name="password" required autocomplete="new-password">
                        <small class="password-hint">Mínimo 8 caracteres, 1 mayúscula, 1 minúscula, 1 número y 1 símbolo (@$!%*?&).</small>
                    </div>
                    <button type="submit" class="button">Registrarse</button>
                    <p class="toggle-auth-view">¿Ya tienes una cuenta? <a href="#" id="showLoginLink">Inicia Sesión</a></p>
                </form>
            </div>
        </section>

        <section id="forgotPasswordView" style="display: none;" aria-labelledby="forgot-password-heading">
            <h2 id="forgot-password-heading">Restablecer Contraseña</h2>
            <p>Ingresa tu correo electrónico y te enviaremos un enlace para restablecer tu contraseña.</p>
            <form id="forgotPasswordForm" role="form" aria-label="Formulario para restablecer contraseña">
                <div class="form-group">
                    <label for="forgotEmail">Email:</label>
                    <input type="email" id="forgotEmail" required aria-required="true">
                </div>
                <button type="submit">Enviar Enlace</button>
                <button type="button" id="backToLogin">Volver a Iniciar Sesión</button>
            </form>
        </section>

        <section id="resetPasswordView" style="display: none;" aria-labelledby="reset-password-heading">
            <h2 id="reset-password-heading">Crear Nueva Contraseña</h2>
            <form id="resetPasswordForm" role="form" aria-label="Formulario para crear nueva contraseña">
                <input type="hidden" id="resetToken">
                <div class="form-group">
                    <label for="newPassword">Nueva Contraseña:</label>
                    <input type="password" id="newPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirmar Nueva Contraseña:</label>
                    <input type="password" id="confirmPassword" required minlength="6">
                </div>
                <button type="submit">Restablecer Contraseña</button>
            </form>
        </section>

        <section id="reservationSection" style="display: none;" aria-labelledby="reservation-heading">
            <h2 id="reservation-heading">Reservar Estacionamiento</h2>
            <div class="date-selector">
                <label for="gridDate">Ver disponibilidad para:</label>
                <input type="date" id="gridDate">
            </div>
            <p>Haga clic en un espacio para seleccionar horario.</p>

            <div id="parkingGrid" class="parking-grid">
                <!-- Parking spots will be generated here by script.js -->
            </div>
        </section>

        <!-- Modal for date/time selection -->
        <div id="reservationModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>Reservar <span id="modalSpotName">Espacio</span></h3>
                <p><strong>Fecha:</strong> <span id="modalDateDisplay"></span></p>
                <div class="time-selection-container">
                    <div class="form-group">
                        <label for="startTime">Hora de entrada:</label>
                        <select id="startTime" required></select>
                    </div>
                    <div class="form-group">
                        <label for="endTime">Hora de salida:</label>
                        <select id="endTime" required></select>
                    </div>
                </div>
                <button id="confirmModalReservation">Confirmar Reserva</button>
            </div>
        </div>

        <section id="myReservationsSection" class="reservations hidden" aria-labelledby="my-reservations-heading">
            <h2 id="my-reservations-heading">Mis Reservas</h2>
            <div id="adminFilters" style="display: none;">
                <label for="userFilter">Filtrar por usuario:</label>
                <select id="userFilter"></select>
            </div>
            <div id="adminControls" style="display: none;"></div>
            <button id="deleteAllButton" class="delete-all-button" style="display: none;">Eliminar Todas las Reservas</button>
            <div id="reservationsList" role="list" aria-label="Lista de reservas existentes"></div>
        </section>

        <section id="adminSection" style="display: none;" aria-labelledby="admin-heading">
            <h2 id="admin-heading">Panel de Administración</h2>
            <h3>Gestionar Usuarios</h3>
            <div class="form-group">
                <label for="userSearchInput">Buscar usuario por nombre o email:</label>
                <input type="text" id="userSearchInput" placeholder="Escriba para filtrar...">
            </div>
            <div class="table-container">
                <table id="usersTable">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>RUT</th>
                            <th>Rol</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Los usuarios se cargarán aquí -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Modal para editar usuario -->
        <div id="editUserModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" id="editUserModalClose">&times;</span>
                <h3>Editar Usuario</h3>
                <form id="editUserForm">
                    <input type="hidden" id="editUserId">
                    <!-- Los campos del formulario se generarán aquí -->
                </form>
            </div>
        </div>


    </main>

    <script type="module" src="api.js" defer></script>
    <script type="module" src="ui.js" defer></script>
    <script type="module" src="toast.js" defer></script>
    <script type="module" src="script.js" defer></script>

    <div id="toast"></div>
</body>
</html>